# -*- coding: utf-8 -*-

from flask import Flask, Response, render_template, request, session
from allintelligence import osint, tech 

app = Flask(__name__)                                                                                                                                                                          


@app.route('/')
def main():
    return render_template('index.html')

@app.route('/analyze', methods=['POST', 'GET'])
def analyze():
    if(request.method == "GET"):
        return '<html><head><meta http-equiv="refresh"content="0; url=/"></head><body></body></html>'
    domain = request.form['domain']
    # To-Do: domain validation

    config = {
        'hunter': request.form.get('switchHunter', False),
        'pipl': request.form.get('switchPipl', False),
        'dehashed': request.form.get('switchDehashed', False),
        'cloudflare': request.form.get('switchCloudflare', False),
        'shodan': request.form.get('switchShodan', False),
        'maxmind': request.form.get('switchMaxmind', False),
        'ftp': request.form.get('switchFTP', False),
        'rdp': request.form.get('switchRDP', False),
        'smtp': request.form.get('switchSMTP', False),
    }
    osint_information = osint.analyze(domain, config)
    tech_information = tech.analyze(domain, osint_information.get('mail_openrelay', None), config)

    return render_template('report.html', tech_information=tech_information, osint_information=osint_information, domain=domain)

@app.route('/report-debug')
def report_debug():
    tech_information = {}
    # dict_emails = {'organization': 'Ies Gran Capitán',  'emails': [{'email': ['rcastillo@iesgrancapitan.org', 'rafa.castillo@gmail.com', 'mail@mail.com', 'rcastillo@uco.es', 'rafaelcg@confluencia.net'], 'type': 'personal', 'confidence': 99, 'first_name': ['Rafael'], 'last_name': ['Castillo'], 'position': None, 'seniority': None, 'department': None, 'linkedin': ['https://inkedin.aaaaa/aaafoo'], 'twitter': ['rafadelcastillo'], 'phone_number': ['+34 638 88 54 01', '+34 927 29 70 22'], 'sources': ['http://informatica.iesgrancapitan.org/nosotros', 'https://www.linkedin.com/in/rafael-del-castillo-gomariz-ab19213b', 'http://www.facebook.com/people/_/1601642213', 'https://informatica.iesgrancapitan.org/nosotros/', 'https://informatica.iesgrancapitan.org/nosotros/', 'http://rcastillo.org', 'https://pk.linkedin.com/company/junta-de-andalucia', 'https://pk.linkedin.com/company/universidad-de-cordoba', 'https://pk.linkedin.com/edu/universidad-de-granada-12214', 'https://il.linkedin.com/company/junta-de-andalucia', 'https://il.linkedin.com/company/universidad-de-cordoba', 'https://il.linkedin.com/edu/universidad-de-granada-12214', 'http://www.facebook.com/rafadelcastillo', 'https://www.linkedin.com/in/rafael-del-castillo-gomariz-ab19213b', 'http://www.facebook.com/people/_/1601642213', 'https://informatica.iesgrancapitan.org/nosotros/', 'https://www.elen.ucl.ac.be/Proceedings/esann/esannpdf/es2006-128.pdf', 'https://informatica.iesgrancapitan.org/nosotros/', 'http://rcastillo.org', 'https://pk.linkedin.com/company/junta-de-andalucia', 'https://pk.linkedin.com/company/universidad-de-cordoba', 'https://pk.linkedin.com/edu/universidad-de-granada-12214', 'https://il.linkedin.com/company/junta-de-andalucia', 'https://il.linkedin.com/company/universidad-de-cordoba', 'https://il.linkedin.com/edu/universidad-de-granada-12214', 'http://www.facebook.com/rafadelcastillo', 'https://www.linkedin.com/in/rub%c3%a9n-dorado-s%c3%a1nchez-castillo-86b59623', 'https://www.linkedin.com/in/rubendorado', 'https://www.linkedin.com/in/rafael-del-castillo-gomariz-ab19213b', 'http://www.facebook.com/people/_/1601642213', 'https://informatica.iesgrancapitan.org/nosotros/', 'https://www.elen.ucl.ac.be/Proceedings/esann/esannpdf/es2006-128.pdf', 'https://informatica.iesgrancapitan.org/nosotros/', 'http://rcastillo.org', 'https://pk.linkedin.com/company/junta-de-andalucia', 'https://pk.linkedin.com/company/universidad-de-cordoba', 'https://pk.linkedin.com/edu/universidad-de-granada-12214', 'https://il.linkedin.com/company/junta-de-andalucia', 'https://il.linkedin.com/company/universidad-de-cordoba', 'https://il.linkedin.com/edu/universidad-de-granada-12214', 'http://www.facebook.com/rafadelcastillo'], 'passwords': [{'password': None, 'hash': '3e867192e696012c477d04c334bb0486a2f43a79', 'origin': 'Dropbox'}, {'password': None, 'hash': '2634690e6b5673ac75bbed03825dfbef1d40da8d', 'origin': 'LinkedIn'}, {'password': None, 'hash': 'c9f4e723b4a094257076125c127113758058cde2', 'origin': 'Tumblr'}], 'usernames': ['rafadelcastillo', 'rubendorado', None, None, None], 'ips': [{None}, {None}, {None}], 'addresses': ['Cordova, Spain', 'Granada, Spain', 'Teresa De Calcuta 2, Cáceres, Spain', 'Seville, Spain', 'Jaén, Spain', 'Milpitas, California', 'San Jose, California', 'Greece', 'Amsterdam, Netherlands', {None}, {None}, {None}], 'jobs': ['Profesor de Secundaria at IES Gran Capitán, especialidad Informática', 'Miembro de grupo de trabajo Escuela TIC 2.0 en Consejería de Educación at Consejería de Educación. Junta de Andalucía (2009-2010)', 'Profesor Adscrito Delegación Educación Córdoba at Consejería de Educación. Junta de Andalucía (2007-2009)', 'Profesor Asociado DEA (6+6) en Universidad de Córdoba, Profesor Enseñanza Secundaria en Consejería de Educación. Junta de Andalucía at Universidad de Córdoba (2000-2012)', 'Profesor Enseñanza Secundaria bei Consejería de Educación. Junta de Andalucía at Consejería de Educación. Junta de Andalucía (since 1990)', 'Profesor Asociado DEA (6+6) chez Universidad de Córdoba, Profesor Enseñanza Secundaria chez Consejería de Educación. Junta de Andalucía', 'Profesor Asociado DEA (6+6) bei Universidad de Córdoba, Profesor Enseñanza Secundaria bei Consejería de Educación. Junta de Andalucía', 'Solar Panel Installer at SunWork (2016-2017)', 'Logistics at Royal FloraHolland (2015-2016)', 'Independent Consultant at Self-employed (2012-2013)', 'Design Engineer at Greenspark (K) LTD (2012-2014)', 'Independent forestry consultant at Self-employed (2010-2011)', 'Forestry Advisor at Private land owners (2010-2012)', 'Design engineer at Tragsatec (2009-2010)', 'Architectural Structural Engineer at EUROCONSULT, S.A. (2006-2009)', 'GIS Technician at Empresa Pública de Desarrollo Agrario y Pesquero (DAP) (2004-2005)', 'Field engineer at University of Cordoba (Spain) (2003-2003)', 'Internship in the wildfire fighting operative at EGMASA (2002-2002)', 'Ingeniero de Montes y Master at Energías Renovables. Experiencia como proyectista y calculista de estructuras.', 'universidad de cordoba'], 'images': ['https://derechomasinformatica.es/bitacora/Ok-wp-content/uploads/2015/02/JedisHBv2.png','http://pbs.twimg.com/media/D_b40i5XUAALNsk.jpg']}, {'email': ['informatica@iesgrancapitan.org'], 'type': 'generic', 'confidence': 95, 'first_name': None, 'last_name': None, 'position': None, 'seniority': None, 'department': 'support', 'linkedin': None, 'twitter': None, 'phone_number': [], 'sources': ['http://informatica.iesgrancapitan.org/bases-tecnicas-competicion-real-time-battle', 'http://informatica.iesgrancapitan.org/aviso-legal', 'http://informatica.iesgrancapitan.org/politica-de-privacidad', 'http://slideshare.net/pablozacrosuarez/apache-27975421', 'http://slideshare.net/pablozacrosuarez/apache-tomcat-8-despliegue-de-una-aplicacin-mediante-el-interfaz', 'http://informatica.iesgrancapitan.org/contacto', 'http://es.slideshare.net/pablozacrosuarez/practica2-medinasuarezpablo', 'http://slideshare.net/pablozacrosuarez/apache-servidor-web-seguro-https', 'http://slideshare.net/pablozacrosuarez/instalacin-de-apache-tomcat-8', 'http://docplayer.es/507731-ies-gran-capitan-departamento-de-informatica-modulo-de-proyecto-integrado-jose-mariscal-prieto-2o-asi-proyecto-copias-de-seguridad-curso-2006-2007.html', 'http://slideshare.net/pablozacrosuarez/instalacin-y-configuracin-de-un', 'http://www.slideshare.net/pablozacrosuarez/apache-tomcat-8despliegue-mediante-terminal-de-una-aplicacin', 'http://www.buenastareas.com/ensayos/Squid-Proyecto/293935.html', 'https://informatica.iesgrancapitan.org/bases-tecnicas-competicion-real-time-battle/', 'https://fr.scribd.com/document/268466631/PI-Cluster-Proxmox-2-nodos-HA', 'https://es.slideshare.net/pablozacrosuarez/practica2-medinasuarezpablo', 'https://es.scribd.com/document/293514967/Servidor-RADIUS', 'https://www.scribd.com/document/339501195/Listado-Basico-Java', 'https://www.slideshare.net/miguelangellopezmoyano3/anexo-web-application-firewall-anexo', 'https://informatica.iesgrancapitan.org/politica-de-privacidad/', 'https://www.slideshare.net/pablozacrosuarez/apache-servidor-web-seguro-https', 'https://informatica.iesgrancapitan.org/aviso-legal/', 'https://www.slideshare.net/pablozacrosuarez/apache-27975421', 'https://informatica.iesgrancapitan.org/contacto/', 'https://www.slideshare.net/pablozacrosuarez/practica12-medinasuarezpablo', 'https://www.slideshare.net/pablozacrosuarez/practica4-medinasuarezpablo', 'http://www.slideshare.net/pablozacrosuarez/practica3-medinasuarezpablo', 'https://www.slideshare.net/pablozacrosuarez/instalacin-de-apache-tomcat-8', 'https://www.slideshare.net/pablozacrosuarez/apache-tomcat-8-despliegue-de-una-aplicacin-mediante-el-interfaz', 'http://www.slideshare.net/pablozacrosuarez/instalacin-y-configuracin-de-un', 'https://www.slideshare.net/EdwinMendoza14/pdc-ldap', 'https://www.slideshare.net/pablozacrosuarez/practica5-medinasuarezpablo', 'https://www.slideshare.net/pablozacrosuarez/practica8-medinasuarezpablo'], 'passwords': [], 'usernames': [], 'ips': [], 'addresses': [], 'jobs': [], 'images': []}, {'email': ['rafalozano@iesgrancapitan.org'], 'type': 'personal', 'confidence': 94, 'first_name': ['Rafael'], 'last_name': ['Lozano'], 'position': None, 'seniority': None, 'department': None, 'linkedin': ['https://www.linkedin.com/in/rafael-del-castillo-gomariz/'], 'twitter': None, 'phone_number': [None, None, None, None], 'sources': ['http://informatica.iesgrancapitan.org/nosotros', 'https://informatica.iesgrancapitan.org/nosotros/'], 'passwords': [], 'usernames': [None, None, None, None], 'ips': [{None}, {None}, {None}, {None}], 'addresses': [{None}, {None}, {None}, {None}], 'jobs': [], 'images': []}, {'email': ['jaimerabasco@iesgrancapitan.org'], 'type': 'personal', 'confidence': 93, 'first_name': ['Jaime'], 'last_name': ['Rabasco'], 'position': None, 'seniority': None, 'department': None, 'linkedin': None, 'twitter': ['jaimerr'], 'phone_number': [None, None], 'sources': ['http://informatica.iesgrancapitan.org/nosotros', 'http://www.twitter.com/jaimerr', 'https://informatica.iesgrancapitan.org/nosotros/'], 'passwords': [{'password': None, 'hash': '$2a$08$QUGaBudCETEMsdXhSEqgCudBYCzfovXwsh2UuwgVJ7/qgrr8ao4bG', 'origin': 'Dropbox'}], 'usernames': ['jaimerr', None, None], 'ips': [{None}, {None}], 'addresses': [{None}, {None}], 'jobs': [], 'images': []}, {'email': ['jralbendin@iesgrancapitan.org', 'jralbendin@gmail.com'], 'type': 'personal', 'confidence': 90, 'first_name': None, 'last_name': None, 'position': None, 'seniority': None, 'department': None, 'linkedin': None, 'twitter': None, 'phone_number': ['+34 607 18 81 86'], 'sources': ['http://informatica.iesgrancapitan.org/nosotros', 'http://docplayer.es/5673086-manual-de-usuario-joomla-2-5.html', 'http://slideshare.net/franjogones/cursojoomlacep-7882554', 'http://docplayer.es/4398521-joomla-joomla-disenos-de-sitios-web-y-comercio-electronico.html', 'http://docplayer.es/9304208-by-ing-jonathan-merino-farias.html', 'http://slideshare.net/carlesr/joomla-gran', 'http://es.slideshare.net/pilazaro/curso-joomla-6918407', 'http://slideshare.net/kurono1984/curso-joomla', 'https://www.linkedin.com/in/jos%C3%A9-ram%C3%B3n-albendin-ram%C3%ADrez-97250125', 'http://twitter.com/jralbendin', 'http://www.facebook.com/people/_/1633050087', 'https://www.slideshare.net/franjogones/cursojoomlacep-7882554', 'https://www.scribd.com/doc/84839246/joomla', 'https://informatica.iesgrancapitan.org/nosotros/', 'http://fliiby.com/file/18133/xqw7zzoslk.html', 'http://www.buenastareas.com/ensayos/Informatica/363760.html', 'http://revistaeco.cepcordoba.org/wp-content/uploads/2016/04/albendin.pdf', 'http://docplayer.es/5673086-Manual-de-usuario-joomla-2-5.html', 'http://www.videoedicion.org/foro/index.php?topic=22491.0', 'http://www.nazarenodebaena.org/index2.php?option=com_contact&task=vcard&contact_id=1&no_html=1', 'http://ww2.castello.san.gva.es/soporte/index.php/manuales/category/1-manuales.html?download=2%3Amanual-joomla', 'http://www.slideshare.net/carlesr/joomla-gran', 'http://www.scribd.com/doc/3782737/Curso-Joomla-del-CEP-de-Coba', 'http://www.slideshare.net/carlesr/joomla-gran', 'http://fliiby.com/file/18133/xqw7zzoslk.html', 'http://www.scribd.com/doc/3782737/Curso-Joomla-del-CEP-de-Coba', 'http://www.videoedicion.org/foro/index.php?topic=22491.0', 'http://www.iesgrancapitan.org/blog04', 'http://jralbendin.blogspot.com', 'http://www.facebook.com/jralbendin', 'https://www.linkedin.com/in/jos%C3%A9-ram%C3%B3n-albendin-ram%C3%ADrez-97250125', 'http://twitter.com/jralbendin', 'http://www.facebook.com/people/_/1633050087', 'https://www.scribd.com/doc/84839246/joomla', 'https://informatica.iesgrancapitan.org/nosotros/', 'http://revistaeco.cepcordoba.org/wp-content/uploads/2016/04/albendin.pdf', 'http://fliiby.com/file/18133/xqw7zzoslk.html', 'http://www.buenastareas.com/ensayos/Informatica/363760.html', 'https://www.slideshare.net/franjogones/cursojoomlacep-7882554', 'http://www.videoedicion.org/foro/index.php?topic=22491.0', 'http://docplayer.es/5673086-Manual-de-usuario-joomla-2-5.html', 'http://www.nazarenodebaena.org/index2.php?option=com_contact&task=vcard&contact_id=1&no_html=1', 'http://ww2.castello.san.gva.es/soporte/index.php/manuales/category/1-manuales.html?download=2%3Amanual-joomla', 'http://www.scribd.com/doc/3782737/Curso-Joomla-del-CEP-de-Coba', 'http://www.videoedicion.org/foro/index.php?topic=22491.0', 'http://www.slideshare.net/carlesr/joomla-gran', 'http://www.scribd.com/doc/3782737/Curso-Joomla-del-CEP-de-Coba', 'http://www.slideshare.net/carlesr/joomla-gran', 'http://fliiby.com/file/18133/xqw7zzoslk.html', 'http://www.iesgrancapitan.org/blog04', 'http://jralbendin.blogspot.com', 'http://www.facebook.com/jralbendin'], 'passwords': [], 'usernames': ['jralbendin'], 'ips': [], 'addresses': ['Cordova, Spain', 'Pl. Dr Gregorio Gracia 7 2 2, Villarrubia, Spain'], 'jobs': ['Coordinador TIC at Junta de Andalucía', 'Coordinador TIC at IES Gran Capitán (since 2007)', 'Profesor de Formación Profesional de Informática at IES Gran Capitán (since 2000)'], 'images': []}, {'email': ['biblioteca@iesgrancapitan.org'], 'type': 'generic', 'confidence': 81, 'first_name': None, 'last_name': None, 'position': None, 'seniority': None, 'department': None, 'linkedin': None, 'twitter': None, 'phone_number': [], 'sources': ['http://educaptic.wordpress.com/category/centros-tic/page/3', 'http://educaptic.wordpress.com/category/noticias-de-caracter-general/page/5', 'http://educaptic.wordpress.com/page/24', 'http://informatica.iesgrancapitan.org/biblioteca-virtual-con-licencia-gpl', 'http://educaptic.wordpress.com/2006/12/19/biblioteca-virtual-con-licencia-gpl', 'http://educaptic.wordpress.com/2006/12', 'http://sisblog.iesgrancapitan.org/?p=46', 'http://educaptic.iesgrancapitan.org/?m=200612', 'https://educaptic.wordpress.com/2006/12/'], 'passwords': [], 'usernames': [], 'ips': [], 'addresses': [], 'jobs': [], 'images': []}, {'email': ['vicedireccion@iesgrancapitan.org'], 'type': 'personal', 'confidence': 79, 'first_name': None, 'last_name': None, 'position': None, 'seniority': None, 'department': None, 'linkedin': None, 'twitter': None, 'phone_number': [], 'sources': ['http://iesgrancapitan.org/contacto', 'http://ticagora.iesgrancapitan.org/?m=201403', 'https://www.iesgrancapitan.org/contacto/', 'https://ticagora.blogs.iesgrancapitan.org/wp-content/uploads/sites/13/2019/05/Presentaci%C3%B3nIES.pdf', 'http://geograncapitan.blogspot.com/2008/09/blog-post.html'], 'passwords': [], 'usernames': [], 'ips': [], 'addresses': [], 'jobs': [], 'images': []}, {'email': ['secretaria@iesgrancapitan.org'], 'type': 'generic', 'confidence': 79, 'first_name': None, 'last_name': None, 'position': None, 'seniority': None, 'department': 'support', 'linkedin': None, 'twitter': None, 'phone_number': [], 'sources': ['http://iesgrancapitan.org/contacto', 'http://secretaria.iesgrancapitan.org', 'https://ticagora.blogs.iesgrancapitan.org/wp-content/uploads/sites/13/2019/05/Presentaci%C3%B3nIES.pdf', 'http://www.educateca.com/areas/acceso-ciclos-grado-superior.asp', 'https://www.iesgrancapitan.org/contacto/', 'https://secretaria.iesgrancapitan.org/', 'http://www.educateca.com/areas/tecnico-servicios-restauracion.asp'], 'passwords': [], 'usernames': [], 'ips': [], 'addresses': [], 'jobs': [], 'images': []}, {'email': ['tic@iesgrancapitan.org'], 'type': 'personal', 'confidence': 79, 'first_name': None, 'last_name': None, 'position': None, 'seniority': None, 'department': None, 'linkedin': None, 'twitter': None, 'phone_number': [], 'sources': ['http://ticagora.iesgrancapitan.org', 'http://iesgrancapitan.org/contacto', 'http://certificatedetails.com/59c6000f2c66170d270ff4d1b9cad7386a9b4144f65a571fb32b8b3068d15e4d/moodle.iesgrancapitan.org', 'http://certificatedetails.com/eb4234d098b0ab9ff41b6b08f7cc642eef0e2c45/662fe3d0a43bc/moodle.iesgrancapitan.org', 'http://iesgrancapitan.org/abies', 'http://iesgrancapitan.org/abies/index.php', 'https://ticagora.blogs.iesgrancapitan.org/wp-content/uploads/sites/13/2019/05/Presentaci%C3%B3nIES.pdf', 'https://www.iesgrancapitan.org/contacto/', 'http://iesgrancapitan.org.whoisbucket.com/', 'https://ticagora.iesgrancapitan.org/?m=200902', 'http://www.iesgrancapitan.org/abies/index.php?page=1&ipagesize=20', 'https://www.iesgrancapitan.org/wp-content/uploads/sites/18/2019/05/02_ROF_V20180418.pdf'], 'passwords': [], 'usernames': [], 'ips': [], 'addresses': ['Carcos De La Frontera Sn, Cordova, Spain'], 'jobs': ['635156435819411020'], 'images': []}, {'email': ['mlmagarin@iesgrancapitan.org'], 'type': 'personal', 'confidence': 78, 'first_name': None, 'last_name': None, 'position': None, 'seniority': None, 'department': None, 'linkedin': None, 'twitter': None, 'phone_number': [], 'sources': ['http://informatica.iesgrancapitan.org/nosotros', 'https://informatica.iesgrancapitan.org/nosotros/'], 'passwords': [], 'usernames': [], 'ips': [], 'addresses': [], 'jobs': [], 'images': []}, {'email': ['jefatura@iesgrancapitan.org'], 'type': 'personal', 'confidence': 77, 'first_name': None, 'last_name': None, 'position': None, 'seniority': None, 'department': None, 'linkedin': None, 'twitter': None, 'phone_number': [], 'sources': ['http://iesgrancapitan.org/contacto', 'http://geograncapitan.blogspot.com/2008/09/', 'https://ticagora.blogs.iesgrancapitan.org/wp-content/uploads/sites/13/2019/05/Presentaci%C3%B3nIES.pdf', 'https://www.iesgrancapitan.org/contacto/'], 'passwords': [], 'usernames': [], 'ips': [], 'addresses': [], 'jobs': [], 'images': []}, {'email': ['secretario@iesgrancapitan.org'], 'type': 'generic', 'confidence': 76, 'first_name': None, 'last_name': None, 'position': None, 'seniority': None, 'department': 'support', 'linkedin': None, 'twitter': None, 'phone_number': [], 'sources': ['http://iesgrancapitan.org/contacto', 'http://geograncapitan.blogspot.com/2008/09/blog-post.html', 'https://ticagora.blogs.iesgrancapitan.org/wp-content/uploads/sites/13/2019/05/Presentaci%C3%B3nIES.pdf', 'https://www.iesgrancapitan.org/contacto/'], 'passwords': [], 'usernames': [], 'ips': [], 'addresses': [], 'jobs': [], 'images': []}, {'email': ['gestiontic@iesgrancapitan.org'], 'type': 'generic', 'confidence': 75, 'first_name': None, 'last_name': None, 'position': None, 'seniority': None, 'department': None, 'linkedin': None, 'twitter': None, 'phone_number': [], 'sources': ['http://es.slideshare.net/vale2108/tic-agentes-innovacioneducativa', 'https://www.scribd.com/doc/19440087/TIC-Como-Agentes-Innovacion-Aula', 'https://es.slideshare.net/vale2108/tic-agentes-innovacioneducativa', 'https://issuu.com/agiampani/docs/tics'], 'passwords': [], 'usernames': [], 'ips': [], 'addresses': [], 'jobs': [], 'images': []}]}
    # osint_information = dict_emails
    osint_information = {'error':'No modules started'}

    return render_template('report.html', tech_information=tech_information, osint_information=osint_information, domain='onbranding.org')

if __name__ == '__main__':                                                                                                                                                                     
    app.run(debug=True)
